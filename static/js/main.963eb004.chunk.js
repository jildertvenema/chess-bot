(this["webpackJsonpreact-chess-bot"]=this["webpackJsonpreact-chess-bot"]||[]).push([[0],{20:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);var o={};n.r(o),n.d(o,"ROOK",(function(){return M})),n.d(o,"KING",(function(){return I})),n.d(o,"QUEEN",(function(){return P})),n.d(o,"BISHOP",(function(){return T})),n.d(o,"KNIGHT",(function(){return B})),n.d(o,"PAWN",(function(){return H}));var i=n(0),r=n.n(i),c=n(12),s=n.n(c),a=n(4),l=n(2),h=(n(20),n(3));class u{}u.routeIsFree=(e,t,n)=>{if("knight"===t.type)return!0;const o=n.x>t.x?1:n.x===t.x?0:-1,i=n.y>t.y?1:n.y===t.y?0:-1;let r=t.y,c=t.x;for(;r!==n.y||c!==n.x;)if(c!==n.x&&(c+=o),r!==n.y&&(r+=i),e[c][r]&&(n.x!==c||n.y!==r))return!1;return!0},u.rook=(e,t)=>e.x===t.x||e.y===t.y,u.king=(e,t)=>{let n=Math.abs(t.y-e.y);return e.x===t.x&&2===n&&0===e.moves||Math.abs(e.x-t.x)<=1&&Math.abs(e.y-t.y)<=1},u.queen=(e,t)=>e.x===t.x||e.y===t.y||Math.abs(e.x-t.x)===Math.abs(e.y-t.y),u.bishop=(e,t)=>Math.abs(e.x-t.x)===Math.abs(e.y-t.y),u.knight=(e,t)=>2===Math.abs(e.x-t.x)&&1===Math.abs(e.y-t.y)||2===Math.abs(e.y-t.y)&&1===Math.abs(e.x-t.x),u.pawn=(e,t)=>{const n="white"===e.color?e.x-t.x:t.x-e.x;if(e.y!==t.y){return 1===Math.abs(t.y-e.y)&&1===n&&t.color&&t.color!==e.color}return!(n<=0)&&((!t.color||t.color===e.color)&&(0===e.moves?n<=2:1===n))};const p="white",b="black",y="king",d="queen",x="pawn";var g={0:["black-rook","black-knight","black-bishop","black-queen","black-king","black-bishop","black-knight","black-rook"],1:["black-pawn","black-pawn","black-pawn","black-pawn","black-pawn","black-pawn","black-pawn","black-pawn"],6:["white-pawn","white-pawn","white-pawn","white-pawn","white-pawn","white-pawn","white-pawn","white-pawn"],7:["white-rook","white-knight","white-bishop","white-queen","white-king","white-bishop","white-knight","white-rook"]};var j,m=n(1);const v=h.a.div(j||(j=Object(l.a)(["\n  height: 400px;\n  overflow-y: scroll;\n  width: 500px;\n  margin: 0 auto;\n  background-color: darkgray;\n  margin-top: 8px;\n  max-width: 100%;\n\n  @media (min-width: 1441px) {\n    position: absolute;\n    right: 16px;\n    top: 20%;\n  }\n"]))),w=e=>new Date(1e3*e).toISOString().substr(11,8);var f=e=>{const t=Object(i.useState)(0),n=Object(a.a)(t,2),o=n[0],r=n[1],c=Object(i.useState)(0),s=Object(a.a)(c,2),l=s[0],h=s[1];return Object(i.useEffect)((()=>{const t=setInterval((()=>{e.lastIsBot?r((e=>e+1)):h((e=>e+1))}),1e3);return()=>clearInterval(t)}),[e.lastIsBot]),Object(m.jsxs)(v,{children:[Object(m.jsxs)("div",{style:{paddingTop:8},children:["Player time: ",w(o)]}),Object(m.jsxs)("div",{children:["Bot time: ",w(l)]}),"------------------------------------",e.children]})},O=n(10),k=n(7);const M=5,I=9999999,P=9,T=3,B=3,H=1,z=e=>e[Math.floor(Math.random()*e.length)],C=(e,t,n)=>{let o=[];for(let i=0;i<8;i++)for(let r=0;r<8;r++){const c=t[i][r];c&&c.color===n&&(o=o.concat(e.getMovesForPiece(c,t).map((e=>({target:e,element:c})))))}return o};let E=0;const S=e=>{let t=0;for(let n=0;n<8;n++)for(let i=0;i<8;i++){const r=e[n][i].type;if(r){let c=r&&o[r.toUpperCase()]||0;e[n][i].color===p?t-=c:e[n][i].color===b&&(t+=c)}}return t},A=(e,t,n)=>{n[e.x][e.y]=0,n[t.x][t.y]=e,e.x=t.x,e.y=t.y,e.moves++,e.type===x&&(e.color===p&&0===e.x&&(e.type=d),e.color===b&&7===e.x&&(e.type=d))},q=(e,t,n)=>{t=Object(k.a)({},t),n=Object(k.a)({},n);const o=(e=>{const t=[];return e.forEach(((e,n)=>{t.push([]),e.forEach(((e,o)=>{t[n][o]=e?Object(k.a)({},e):0}))})),t})(e);if(t.type===y&&2===Math.abs(t.y-n.y)&&0===t.moves){let e=null,i=0;if(t.color===p&&(i=7),t.x===i){let r=1;n.y>t.y?(e=o[i][7],r=5):(e=o[i][0],r=3),e&&A(e,{x:i,y:r},o)}}return A(t,n,o),o},F=(e,t,n,o,i,r)=>{if(E++,0===n)return{value:S(t)};const c=(e=>{const t=[];return e.forEach((e=>{e.forEach((e=>{e&&e.type===y&&t.push(e)}))})),2!==t.length&&t[0]})(t);if(c&&c.color===b)return{value:1/0};if(c&&c.color===p)return{value:-1/0};if(o){let o=-1/0;const c=C(e,t,"black");let l=z(c);var s,a=Object(O.a)(c);try{for(a.s();!(s=a.n()).done;){let c=s.value,a=c.element,h=c.target;const u=q(t,a,h),p=F(e,u,n-1,!1,i,r),b=p&&p.value?p.value:0;if(b>o&&(o=b,l={element:a,target:h,value:b}),(i=Math.max(i,b))>=r)break}}catch(u){a.e(u)}finally{a.f()}return l}{let o=1/0;const c=C(e,t,"white");let s=z(c);var l,h=Object(O.a)(c);try{for(h.s();!(l=h.n()).done;){let c=l.value,a=c.element,h=c.target;const u=q(t,a,h),p=F(e,u,n-1,!0,i,r),b=p&&p.value?p.value:0;if(b<o&&(o=b,s={element:a,target:h,value:b}),i>=(r=Math.min(r,b)))break}}catch(u){h.e(u)}finally{h.f()}return s}};var L,N,K,V,G,U,W,D,J=e=>new Promise((t=>{E=0;const n=F(e,e.board,4,!0,-1/0,1/0),o=n.element,i=n.target,r=n.value,c=document.getElementById("bot-points");c.innerHTML="Bot eval: "+r,r>0?(c.innerHTML+=" (in bot's favour)",c.style.color="red"):r<0?(c.innerHTML+=" (in your favour)",c.style.color="green"):(c.innerHTML="Bot points: 0 (tie)",c.style.color="white");document.getElementById("bot-evaluated").innerHTML=E+" moves evaluated.",t({element:o,target:i})}));const R=h.a.div(L||(L=Object(l.a)(["\n  position: relative;\n  width: 92vh;\n  height: 92vh;\n\n  @media (max-width: 900px) {\n    width: 92vw;\n    height: 92vw;\n  }\n\n  max-width: 900px;\n  max-height: 900px;\n  margin: 0 auto;\n  user-select: none;\n"]))),Q=h.a.div(N||(N=Object(l.a)(["\n  position: absolute;\n  left: ","%;\n  top: ","%;\n  height: 12.5%;\n  width: 12.5%;\n  transition: top 1s ease-in-out;\n\n  background-color: ",";\n\n  background-color: ",";\n  border: ",";\n  z-index: ",";\n"])),(e=>12.5*e.left),(e=>12.5*e.top),(e=>(e.left+e.top)%2?"#575757":"gray"),(e=>e.highlighted&&"#176717"),(e=>e.highlighted&&"1px solid #726969"),(e=>e.highlighted&&"3")),X=h.a.div(K||(K=Object(l.a)(['\n  background-image: url("','");\n  background-size: cover;\n  cursor: pointer;\n  width: 100%;\n  height: 100%;\n\n  opacity: 0.8;\n  \n'])),(e=>e.image)),Y=h.a.div(V||(V=Object(l.a)(["\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background-color: grey;\n  opacity: 0.8;\n  z-index: 3;\n"]))),Z=h.a.div(G||(G=Object(l.a)(["\n  color: white;\n  font-size: 32px;\n  height: 40px;\n  margin-top: 20%;\n"]))),$=h.a.div(U||(U=Object(l.a)(["\n  color: white;\n  font-size: 26px;\n  margin-top: 16px;\n  margin-bottom: 4px;\n"]))),_=Object(h.a)(Y)(W||(W=Object(l.a)(["\n  position: fixed;\n"]))),ee=h.a.div(D||(D=Object(l.a)(["\n  width: 100px;\n  height: 100px;\n  z-index: 5;\n  border: 1px solid darkgray;\n  margin: 16px;\n  float: left;\n"]))),te=new class{constructor(){this.board=[],this.currentTurn=p,this.winner=null,this.moveHistory=[],this.resetGame=()=>{this.board=[],this.currentTurn=p,this.winner=null,this.initializeBoard()},this.initializeBoard=()=>{(e=>{for(let t=0;t<8;t++)for(let n=0;n<8;n++)e(t,n)})(((e,t)=>{this.board[e]||this.board.push([]);const n=g[e]&&g[e][t];if(n){const o=n.startsWith(p)?p:b,i=n.substring(n.indexOf("-")+1);this.board[e].push({x:e,y:t,moves:0,color:o,type:i})}else this.board[e].push(0)}))},this.swapPieces=(e,t)=>{this.getPieceAtPosition(t).type===y&&(this.winner=e.color),this.board[e.x][e.y]=0,this.board[t.x][t.y]=e,e.x=t.x,e.y=t.y,e.type===x&&(e.color===p&&0===e.x&&(e.type=d),e.color===b&&7===e.x&&(e.type=d)),e.moves++},this.getPieceAtPosition=(e,t)=>(t||this.board)[e.x][e.y],this.isValidMove=(e,t,n)=>{if(n=n||this.board,e.x===t.x&&e.y===t.y)return!1;const o=this.getPieceAtPosition(t,n);if(o&&o.color===e.color)return!1;const i=u[e.type];if(!i)return!1;const r=i(e,o||t),c=u.routeIsFree(n,e,t);if(e.type===y&&2===Math.abs(e.y-t.y)&&0===e.moves){let o=null,i=0;if(e.color===p&&(i=7),e.x===i){let s=1;return t.y>e.y?(o=n[i][7],s=5):(o=n[i][0],s=3),o&&c&&r&&0===o.moves}return!1}return c&&r},this.doMove=(e,t)=>{if(e.color===this.currentTurn&&this.isValidMove(e,t)){if(this.moveHistory=[{piece:e,target:this.getPieceAtPosition(t)||t},...this.moveHistory],e.type===y&&2===Math.abs(e.y-t.y)&&0===e.moves){let n=null,o=0;if(e.color===p&&(o=7),e.x===o){let i=1;t.y>e.y?(n=this.board[o][7],i=5):(n=this.board[o][0],i=3),n&&this.swapPieces(n,{x:o,y:i})}}return this.swapPieces(e,t),this.currentTurn=this.currentTurn===p?b:p,!0}return console.error("NOT VALID MOVE",e,t),!1},this.promote=({x:e,y:t},n)=>{this.board[e][t].type=n},this.getMovesForPiece=(e,t)=>{const n=[];for(let o=0;o<8;o++)for(let i=0;i<8;i++){const r={x:o,y:i},c=u.routeIsFree(t||this.board,e,r);this.isValidMove(e,r,t)&&c&&n.push(r)}return n},this.initializeBoard()}};let ne=null;const oe=r.a.memo((function({x:e,y:t,piece:n,highlighted:o,onClick:i,pieceKey:r}){return Object(m.jsx)(Q,{left:t,top:e,highlighted:o,onClick:()=>i(n,e,t),children:r?Object(m.jsx)(X,{image:"pieces-images/"+r+".png"}):null},e+"-"+t)}),(function(e,t){return t.highlighted===e.highlighted&&t.piece.type===e.piece.type&&t.piece.color===e.piece.color}));function ie(){const e=Object(i.useState)(null),t=Object(a.a)(e,2),n=t[0],o=t[1],r=Object(i.useState)([]),c=Object(a.a)(r,2),s=c[0],l=c[1],h=Object(i.useState)(!1),u=Object(a.a)(h,2),p=u[0],b=u[1],y=Object(i.useState)(null),d=Object(a.a)(y,2),x=d[0],g=d[1],j=Object(i.useRef)(),v=e=>{const t=te.getMovesForPiece(e);l(t)},w=(e,t)=>{g(e);const n=12.5*e.y,o=12.5*e.x;j.current.style.left=n+"%",j.current.style.top=o+"%",j.current.style.display="block";const i=12.5*t.y,r=12.5*t.x,c=(i-n)/20,s=(r-o)/20;let a=n,l=o;const h=setInterval((()=>{a+=c,l+=s,j.current.style.left=a+"%",j.current.style.top=l+"%"}),20);setTimeout((()=>{clearInterval(h),j.current.style.left=i+"%",j.current.style.top=r+"%",j.current.style.display="none",g(null)}),400)},O=()=>{setTimeout((()=>{J(te).then((({element:e,target:t})=>{w(e,t),te.doMove(e,t),l([])}))}),500)},k=(e,t,i)=>{if(n){const r="pawn"===n.type;w(ne||n,{x:t,y:i}),te.doMove(ne||n,{x:t,y:i})?(r&&0===t?b({x:t,y:i}):O(),ne=null,o(null),l([])):"white"===e.color&&(ne=e,o(e),v(e))}else"white"===e.color&&(ne=e,o(e),v(e))},M=(e,t,n)=>s.find((e=>e.x===t&&e.y===n))&&(!e.color||e.color!==te.currentTurn),I=e=>{te.promote(p,e),b(!1),O()};return Object(m.jsxs)("div",{className:"App",children:[p&&Object(m.jsxs)(_,{children:[Object(m.jsx)(Z,{children:"Pawn promotion"}),Object(m.jsx)(ee,{onClick:()=>I("queen"),children:Object(m.jsx)(X,{image:"pieces-images/white-queen.png"})}),Object(m.jsx)(ee,{onClick:()=>I("bishop"),children:Object(m.jsx)(X,{image:"pieces-images/white-bishop.png"})}),Object(m.jsx)(ee,{onClick:()=>I("rook"),children:Object(m.jsx)(X,{image:"pieces-images/white-rook.png"})}),Object(m.jsx)(ee,{onClick:()=>I("knight"),children:Object(m.jsx)(X,{image:"pieces-images/white-knight.png"})})]}),Object(m.jsxs)($,{children:["Current Turn:","white"===te.currentTurn?" White (you)":" Black (AI)"]}),Object(m.jsx)("div",{id:"bot-points"}),Object(m.jsx)("div",{id:"bot-evaluated"}),te.winner&&Object(m.jsxs)(Y,{children:[Object(m.jsxs)(Z,{children:[te.winner[0].toUpperCase()+te.winner.substring(1)," wins!"]}),Object(m.jsx)("button",{onClick:()=>{te.resetGame(),l([])},children:"Play again"})]}),Object(m.jsxs)(R,{children:[te.board.map(((e,t)=>e.map(((e,n)=>Object(m.jsx)(oe,{pieceKey:x!==e&&e.color+"-"+e.type,y:n,x:t,piece:e,highlighted:M(e,t,n),onClick:k},t+"-"+n+e.color+"-"+e.type+x))))),Object(m.jsx)("div",{ref:j,style:{position:"absolute",width:"12.5%",height:"12.5%",zIndex:9,backgroundSize:"cover",transition:"",opacity:.8,backgroundImage:x&&'url("pieces-images/'.concat(x.color,"-").concat(x.type,'.png")')}})]}),Object(m.jsx)(f,{lastIsBot:!te.moveHistory.length||"black"===te.moveHistory[0].piece.color,children:te.moveHistory.map((({piece:e,target:t},n)=>Object(m.jsxs)("div",{children:[te.moveHistory.length-n+": ",e.color+" ",e.type," x: "+e.x," y: "+e.y,t.type?" takes "+t.color+" "+t.type:" to "," x: "+t.x," y: "+t.y]},n)))})]})}const re=document.getElementById("root");s.a.render(Object(m.jsx)(i.StrictMode,{children:Object(m.jsx)(ie,{})}),re)}},[[24,1,2]]]);
//# sourceMappingURL=main.963eb004.chunk.js.map